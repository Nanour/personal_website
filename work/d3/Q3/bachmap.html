<!DOCTYPE html>
<meta charset="utf-8">
<style>

#map{
  float: right;
  margin-right: 100px;
}

.counties {
  fill: none;
}

.states {
  fill: none;
  stroke: #fff;
  stroke-linejoin: round;
}

.q8-9 { fill:rgb(0,69,41); }
.q7-9 { fill:rgb(0,104,55); }
.q6-9 { fill:rgb(35,132,67); }
.q5-9 { fill:rgb(65,171,93); }
.q4-9 { fill:rgb(120,198,121); }
.q3-9 { fill:rgb(173,221,142); }
.q2-9 { fill:rgb(217,240,163); }
.q1-9 { fill:rgb(247,252,185); }
.q0-9 { fill:rgb(255,255,229); }

#tooltip-container {
  position: absolute;
  background-color: #eee;
  color: #000;
  padding: 10px;
  border: 1px solid;
  display: none;
}

.tooltip_key {
  font-weight: bold;
}

.tooltip_key_rank {
  font-weight: bold;
}
.tooltip_value {
  margin-left: 20px;
  float: right;
}

.tooltip_value_rank {
  margin-left: 20px;
  float: right;
}

.maplegend{
  float: left;
  margin: 50px;
  padding-top: 80px;
}

.figtitle{
  text-align: center;
}

h1{
  text-shadow: 3px 3px 3px rgb(120,198,121);
}
.figtitle a{
  margin-right:20px;
}



</style>
<body>

<div id="tooltip-container" class = "tooltip-containers">
  <div id = "tooltip-message" class = "tooltip-message">
  </div>
  <div id = "tooltip-bar" class = "tooltip-bar">
    <h4>2000</h4>
    <svg width = "230" height = "60">
      <g class = "thighbar">
        <rect id ="thighrect" y="40" width="180px" height="20px" fill="rgb(66,146,198)"></rect>
      </g>
      <g class = "tbachbar">
        <rect id = "tbachrect" y="20" width="40px" height="20px" fill="rgb(120,198,121)"></rect>
      </g>
      <g class = "tadvbar">
        <rect id = "tadvrect" y="0" width="20px" height="20px" fill="rgb(253,187,132)"></rect>
      </g>
      <text id="tadvtxt" x="220" y="16"></text>
      <text id="tbachtxt" x="280" y="36"></text>
      <text id="thightxt" x="340" y="56"></text>
    </svg>
    <br/>
    <h4>2009</h4>
    <svg width = "230" height = "60">
      <g class = "bhighbar">
        <rect id = "bhighrect" y="40" width="180px" height="20px" fill="rgb(66,146,198)"></rect>
      </g>
      <g class = "bbachbar">
        <rect id = "bbachrect" y="20" width="40px" height="20px" fill="rgb(120,198,121)"></rect>
      </g>
      <g class = "badvbar">
        <rect id = "badvrect" y="0" width="20px" height="20px" fill="rgb(253,187,132)"></rect>
      </g>
      <text id="badvtxt" x="220" y="16"></text>
      <text id="bbachtxt" x="280" y="36"></text>
      <text id="bhightxt" x="340" y="56"></text>
    </svg>
  </div>
</div>
<div id="figtitle" class="figtitle">
  <h1>Data change between 2000 and 2009 Bachelor Degree or More</h1>
  <svg width = "20" height = "20">
      <g>
        <rect y = "10" width="10px" height="10px" fill="rgb(66,146,198)"></rect>
      </g>
  </svg>
  <a href="highmap.html">High School or More</a>
    <svg width = "20" height = "20">
      <g>
        <rect y = "10" width="10px" height="10px" fill="rgb(120,198,121)"></rect>
      </g>
  </svg>
  <a href="bachmap.html">Bachelor Degree or More</a>
    <svg width = "20" height = "20">
      <g>
        <rect y = "10" width="10px" height="10px" fill="rgb(253,187,132)"></rect>
      </g>
  </svg>
  <a href="advmap.html">Advanced Degree or More</a>
  
</div>
<div id="map" class="map"></div>

<div id="maplegend" class="maplegend">
  <svg width = "140" height = "1000">
    <g class="leg">
      <rect y="0" width="40px" height="40px" fill="rgb(255,255,229)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="24">≤ 0.55% </text>
    </g>
    <g class="leg">
      <rect y="40" width="40px" height="40px" fill="rgb(247,252,185)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="64">0.55% ≤ 1.1%</text>
    </g>
    <g class="leg">
      <rect y="80" width="40px" height="40px" fill="rgb(217,240,163)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="104">1.1% ≤ 1.65%</text>
    </g>
    <g class="leg">
      <rect y="120" width="40px" height="40px" fill="rgb(173,221,142)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="144">1.65% ≤ 2.2%</text>
    </g>
    <g class="leg">
      <rect y="160" width="40px" height="40px" fill="rgb(120,198,121)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="184">2.2% ≤ 2.75%</text>
    </g>
    <g class="leg">
      <rect y="200" width="40px" height="40px" fill="rgb(65,171,93)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="224">2.75% ≤ 3.3%</text>
    </g>
    <g class="leg">
      <rect y="240" width="40px" height="40px" fill="rgb(35,132,67)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="264">3.3% ≤ 3.85%</text>
    </g>
    <g class="leg">
      <rect y="280" width="40px" height="40px" fill="rgb(0,104,55)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="304">3.85% ≤ 4.4%</text>
    </g>
    <g class="leg">
      <rect y="320" width="40px" height="40px" fill="rgb(0,69,41)" stroke="#7f7f7f" stroke-width="0.5"></rect>
      <text class="legText" x="45" y="344">≥ 4.4%</text>
    </g>
  </svg>
</div>



<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script>

var width = 960,
    height = 600;

var rateById = d3.map();

var quantize = d3.scale.quantize()
    .domain([.00, .05])
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

var projection = d3.geo.albersUsa()
    .scale(1280)
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var zoom = d3.behavior.zoom()
    .translate(projection.translate())
    .scale(projection.scale())
    .scaleExtent([height, 8 * height])

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height)

d3.tsv("raw_data.tsv", function(error, states) {
    id_state_map = {}
    id_zhigh_map = {}
    id_zbach_map = {}
    id_zadv_map = {}
    id_nhigh_map = {}
    id_nbach_map = {}
    id_nadv_map = {}
    
    for (var i = 0; i< states.length; i++) {
        id_state_map[states[i].id] = states[i].state;
        id_zhigh_map[states[i].id] = states[i].zhigh;
        id_zbach_map[states[i].id] = states[i].zbach;
        id_zadv_map[states[i].id] = states[i].zadv;
        id_nhigh_map[states[i].id] = states[i].nhigh;
        id_nbach_map[states[i].id] = states[i].nbach;
        id_nadv_map[states[i].id] = states[i].nadv;
    }
});

queue()
    .defer(d3.json, "us.json")
    .defer(d3.tsv, "raw_data.tsv", function(d) { rateById.set(d.id, +d.rateb); })
    .await(ready);

function ready(error, us) {
  svg.append("g")
      .attr("class", "states")
    .selectAll("path")
      .data(topojson.feature(us, us.objects.states).features)
    .enter().append("path")
      .attr("id", function(d) { return d.id; })
      .attr("class", function(d) { return quantize(rateById.get(d.id)); })
      .attr("d", path)
      .on("mousemove", function(d) {
          var html = "";

          html += "<div class=\"tooltip_kv\">";
          html += "<span class=\"tooltip_key\">";
          
          html += "<p>";
          html += id_state_map[d.id];
          html += "</p>";
          
          html += "</span>";
          html += "</div>";
          
          //$("#tooltip-container").html(html);
          $("#tooltip-message").html(html);
          
          $("#thighrect").attr("width", (id_zhigh_map[d.id]*1.8) + "px");
          $("#tbachrect").attr("width", (id_zbach_map[d.id]*1.8) + "px");
          $("#tadvrect").attr("width", (id_zadv_map[d.id]*1.8) + "px");
          
          $("#bhighrect").attr("width", (id_nhigh_map[d.id]*1.8) + "px");
          $("#bbachrect").attr("width", (id_nbach_map[d.id]*1.8) + "px");
          $("#badvrect").attr("width", (id_nadv_map[d.id]*1.8) + "px");
          
          $("#thightxt").html(id_zhigh_map[d.id] + "%");
          $("#thightxt").attr("x", (id_zhigh_map[d.id]*1.8 + 4) + "");
          $("#tbachtxt").html(id_zbach_map[d.id] + "%");
          $("#tbachtxt").attr("x", (id_zbach_map[d.id]*1.8 + 4) + "");
          $("#tadvtxt").html(id_zadv_map[d.id] + "%");
          $("#tadvtxt").attr("x", (id_zadv_map[d.id]*1.8 + 4) + "");
          
          $("#bhightxt").html(id_nhigh_map[d.id] + "%");
          $("#bhightxt").attr("x", (id_nhigh_map[d.id]*1.8 + 4) + "");
          $("#bbachtxt").html(id_nbach_map[d.id] + "%");
          $("#bbachtxt").attr("x", (id_nbach_map[d.id]*1.8 + 4) + "");
          $("#badvtxt").html(id_nadv_map[d.id] + "%");
          $("#badvtxt").attr("x", (id_nadv_map[d.id]*1.8 + 4) + "");
          
          $(this).attr("fill-opacity", "0.8");
          $("#tooltip-container").show();
          
          var coordinates = d3.mouse(this);
          d3.select("#tooltip-container")
            .style("top", (d3.event.pageY + 15) + "px")
            .style("left", (d3.event.pageX + 15) + "px");
      })
      .on("mouseout", function() {
              $(this).attr("fill-opacity", "1.0");
              $("#tooltip-container").hide();
          });
}


</script>
</body>
